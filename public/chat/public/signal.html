<!-- Version: 1.0056 -->
<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª - AMS Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .limit-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .photo-upload {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .photo-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .photo-upload.has-image {
            border-color: #4caf50;
            background: #f1f8f4;
        }
        
        .photo-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 15px;
            border-radius: 10px;
        }
        
        #fileInput {
            display: none;
        }
        
        .location-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .location-coords {
            font-family: monospace;
            color: #1976d2;
            margin-top: 5px;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4caf50;
        }
        
        .char-count {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® –ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª</h1>
        <p class="subtitle">
            –ü–æ–º–æ–≥–Ω–∏ –Ω–∞ –æ–±—â–Ω–æ—Å—Ç—Ç–∞ –∫–∞—Ç–æ –ø–æ–¥–∞–¥–µ—à —Å–∏–≥–Ω–∞–ª –∑–∞ –æ–±–µ–∫—Ç, —É—Å–ª—É–≥–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏–µ. 
            –°–ª–µ–¥ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–≤–∞—à <strong>1 –±–µ–∑–ø–ª–∞—Ç–µ–Ω –¥–µ–Ω</strong> –¥–æ—Å—Ç—ä–ø –¥–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞!
        </p>
        
        <div class="limit-info">
            ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –ú–æ–∂–µ—à –¥–∞ –ø–æ–¥–∞–¥–µ—à —Å–∞–º–æ <strong>–µ–¥–∏–Ω —Å–∏–≥–Ω–∞–ª –Ω–∞ –¥–µ–Ω</strong>. 
            –§–∞–ª—à–∏–≤–∏—Ç–µ —Å–∏–≥–Ω–∞–ª–∏ –Ω—è–º–∞ –¥–∞ –±—ä–¥–∞—Ç –æ–¥–æ–±—Ä–µ–Ω–∏.
        </div>
        
        <div id="message"></div>
        
        <form id="signalForm">
            <div class="form-group">
                <label for="signalType">–¢–∏–ø –Ω–∞ —Å–∏–≥–Ω–∞–ª–∞ *</label>
                <select id="signalType" required>
                    <option value="">–ò–∑–±–µ—Ä–∏ —Ç–∏–ø...</option>
                    <optgroup label="–ú–µ—Å—Ç–∞ –∏ –æ–±–µ–∫—Ç–∏">
                        <option value="Pharmacy">–ê–ø—Ç–µ–∫–∞</option>
                        <option value="Optician/Eyewear">–û–ø—Ç–∏–∫–∞/–ò–∑—Ä–∞–±–æ—Ç–≤–∞–Ω–µ –Ω–∞ –æ—á–∏–ª–∞</option>
                        <option value="Computer Repair">–ö–æ–º–ø—é—Ç—ä—Ä–µ–Ω —Å–µ—Ä–≤–∏–∑</option>
                        <option value="Computer Store">–ö–æ–º–ø—é—Ç—ä—Ä–µ–Ω –º–∞–≥–∞–∑–∏–Ω</option>
                        <option value="Shopping Center/Market">–¢—ä—Ä–≥–æ–≤—Å–∫–∏ —Ü–µ–Ω—Ç—ä—Ä/–ü–∞–∑–∞—Ä</option>
                        <option value="Building Materials Store">–°—Ç—Ä–æ–∏—Ç–µ–ª–µ–Ω –º–∞–≥–∞–∑–∏–Ω</option>
                        <option value="Construction Exchange">–°—Ç—Ä–æ–∏—Ç–µ–ª–Ω–∞ –±–æ—Ä—Å–∞</option>
                        <option value="Beauty/Hair Salon">–ö–æ–∑–º–µ—Ç–∏—á–µ–Ω/–§—Ä–∏–∑—å–æ—Ä—Å–∫–∏ —Å–∞–ª–æ–Ω</option>
                        <option value="Massage">–ú–∞—Å–∞–∂</option>
                        <option value="Sauna">–°–∞—É–Ω–∞</option>
                        <option value="Swimming Pool">–ü–ª—É–≤–µ–Ω –±–∞—Å–µ–π–Ω</option>
                        <option value="Gym">–°–ø–æ—Ä—Ç–Ω–∞ –∑–∞–ª–∞</option>
                        <option value="Clothing Store">–ú–∞–≥–∞–∑–∏–Ω –∑–∞ –¥—Ä–µ—Ö–∏</option>
                        <option value="Gift Shop">–ú–∞–≥–∞–∑–∏–Ω –∑–∞ –ø–æ–¥–∞—Ä—ä—Ü–∏</option>
                        <option value="Flower Shop">–¶–≤–µ—Ç–∞—Ä—Å–∫–∏ –º–∞–≥–∞–∑–∏–Ω</option>
                        <option value="GSM Repair">GSM —Å–µ—Ä–≤–∏–∑</option>
                        <option value="Appliance Repair">–°–µ—Ä–≤–∏–∑ –±—è–ª–∞ —Ç–µ—Ö–Ω–∏–∫–∞</option>
                        <option value="Appliance Store">–ú–∞–≥–∞–∑–∏–Ω –±—è–ª–∞ —Ç–µ—Ö–Ω–∏–∫–∞</option>
                        <option value="Bar">–ë–∞—Ä</option>
                        <option value="Coffee/Sweets">–ö–∞—Ñ–µ/–°–ª–∞–¥–∫–∞—Ä–Ω–∏—Ü–∞</option>
                        <option value="Fast Food">–ë—ä—Ä–∑–æ —Ö—Ä–∞–Ω–µ–Ω–µ</option>
                        <option value="Hi Class Food">–†–µ—Å—Ç–æ—Ä–∞–Ω—Ç</option>
                    </optgroup>
                    <optgroup label="–ü—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏—è">
                        <option value="Accident">–ê–≤–∞—Ä–∏—è</option>
                        <option value="Person Needing Help">–ß–æ–≤–µ–∫ –Ω—É–∂–¥–∞–µ—â —Å–µ –æ—Ç –ø–æ–º–æ—â</option>
                    </optgroup>
                </select>
            </div>
            
            <div class="form-group">
                <label for="title">–ó–∞–≥–ª–∞–≤–∏–µ/–ò–º–µ –Ω–∞ –æ–±–µ–∫—Ç–∞ * (–º–∞–∫—Å. 100 —Å–∏–º–≤–æ–ª–∞)</label>
                <input type="text" id="title" maxlength="100" required placeholder="–Ω–∞–ø—Ä. –ê–ø—Ç–µ–∫–∞ '–ó–¥—Ä–∞–≤–µ', –†–µ—Å—Ç–æ—Ä–∞–Ω—Ç '–ß–µ—Ä–Ω–∞—Ç–∞ –¥—É–ø–∫–∞'">
                <div class="char-count"><span id="titleCount">0</span>/100</div>
            </div>
            
            <div class="form-group">
                <label for="workingHours">–†–∞–±–æ—Ç–Ω–æ –≤—Ä–µ–º–µ (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–∞)</label>
                <input type="text" id="workingHours" maxlength="50" placeholder="–Ω–∞–ø—Ä. –î–µ–Ω–æ–Ω–æ—â–Ω–æ, 09:00-18:00, –ü–æ—á–∏–≤–µ–Ω: –ù–µ–¥–µ–ª—è">
                <div class="char-count"><span id="hoursCount">0</span>/50</div>
            </div>
            
            <div class="form-group">
                <label>–°–Ω–∏–º–∫–∞ *</label>
                <div class="photo-upload" id="photoUpload" onclick="document.getElementById('fileInput').click()">
                    <div id="uploadText">
                        üì∑ –ö–ª–∏–∫–Ω–∏ –∑–∞ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Å–Ω–∏–º–∫–∞<br>
                        <small>–ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ: —Å–Ω–∏–º–∫–∞ –Ω–∞ –æ–±–µ–∫—Ç–∞/–º—è—Å—Ç–æ—Ç–æ</small>
                    </div>
                    <img id="photoPreview" class="photo-preview" style="display:none;">
                </div>
                <input type="file" id="fileInput" accept="image/*" required>
            </div>
            
            <div class="form-group">
                <label>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ *</label>
                <button type="button" class="btn btn-secondary" id="getLocationBtn">
                    üìç –í–∑–µ–º–∏ —Ç–µ–∫—É—â–∞—Ç–∞ –º–∏ –ª–æ–∫–∞—Ü–∏—è
                </button>
                <div id="locationInfo" class="location-info" style="display:none;">
                    ‚úÖ –õ–æ–∫–∞—Ü–∏—è—Ç–∞ –µ –∑–∞—Å–Ω–µ—Ç–∞!
                    <div class="location-coords" id="locationCoords"></div>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                –ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª
            </button>
            
            <button type="button" class="btn btn-secondary" onclick="window.location.href='chat.html'">
                –û—Ç–∫–∞–∑
            </button>
        </form>
    </div>
    
    <script>
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:3000' : '';
        let latitude = null;
        let longitude = null;
        let selectedFile = null;
        
        // AUTO-CAPTURE LOCATION ON PAGE LOAD
        window.addEventListener('DOMContentLoaded', () => {
            checkEligibility();
            autoGetLocation();
        });
        
        // Check if user can submit signal today
        async function checkEligibility() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'index.html';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/signals/can-submit`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (!data.canSubmit) {
                    showError('–í–µ—á–µ —Å–∏ –ø–æ–¥–∞–ª —Å–∏–≥–Ω–∞–ª –¥–Ω–µ—Å. –û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ —É—Ç—Ä–µ!');
                    document.getElementById('signalForm').style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking eligibility:', error);
            }
        }
        
        // Character counters
        document.getElementById('title').addEventListener('input', (e) => {
            document.getElementById('titleCount').textContent = e.target.value.length;
        });
        
        document.getElementById('workingHours').addEventListener('input', (e) => {
            document.getElementById('hoursCount').textContent = e.target.value.length;
        });
        
        // Photo upload
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                selectedFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('photoPreview').src = e.target.result;
                    document.getElementById('photoPreview').style.display = 'block';
                    document.getElementById('uploadText').style.display = 'none';
                    document.getElementById('photoUpload').classList.add('has-image');
                    checkFormComplete();
                };
                reader.readAsDataURL(file);
            }
        });
        
        // AUTO GET LOCATION ON PAGE LOAD
        function autoGetLocation() {
            if (!navigator.geolocation) {
                return;
            }
            
            document.getElementById('getLocationBtn').innerHTML = '‚è≥ –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ª–æ–∫–∞—Ü–∏—è...';
            document.getElementById('getLocationBtn').disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude;
                    
                    document.getElementById('locationInfo').style.display = 'block';
                    document.getElementById('locationCoords').textContent = 
                        `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    
                    document.getElementById('getLocationBtn').innerHTML = '‚úÖ –õ–æ–∫–∞—Ü–∏—è—Ç–∞ –µ –∑–∞—Å–Ω–µ—Ç–∞';
                    
                    // CHECK NEARBY SIGNALS (100m radius, first 5)
                    await checkNearbySignals(latitude, longitude);
                    
                    checkFormComplete();
                },
                (error) => {
                    document.getElementById('getLocationBtn').innerHTML = 'üìç –í–∑–µ–º–∏ —Ç–µ–∫—É—â–∞—Ç–∞ –º–∏ –ª–æ–∫–∞—Ü–∏—è';
                    document.getElementById('getLocationBtn').disabled = false;
                }
            );
        }
        
        // Check for nearby signals within 100m
        async function checkNearbySignals(lat, lng) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(
                    `${API_URL}/api/signals/nearby?latitude=${lat}&longitude=${lng}&radius=100&limit=5`,
                    {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.objects && data.objects.length > 0) {
                        showNearbyWarning(data.objects);
                    }
                }
            } catch (error) {
                console.error('Error checking nearby signals:', error);
            }
        }
        
        // Show nearby objects list with full details
        function showNearbyWarning(objects) {
            const objectsHTML = objects.map(obj => `
                <div style="border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin: 10px 0; background: white;">
                    <div style="display: flex; gap: 15px;">
                        ${obj.photoUrl ? `
                            <img src="${obj.photoUrl}" alt="${obj.title}" 
                                 style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                        ` : `
                            <div style="width: 80px; height: 80px; background: #f0f0f0; border-radius: 8px; 
                                        display: flex; align-items: center; justify-content: center; font-size: 40px;">
                                üìç
                            </div>
                        `}
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 5px 0; color: #333;">${obj.title}</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">${obj.type}</p>
                            ${obj.workingHours ? `
                                <p style="margin: 5px 0 0 0; color: #666; font-size: 13px;">‚è∞ ${obj.workingHours}</p>
                            ` : ''}
                            <p style="margin: 5px 0 0 0; color: #999; font-size: 12px; font-family: monospace;">
                                üìç ${obj.latitude.toFixed(6)}, ${obj.longitude.toFixed(6)}
                            </p>
                            <p style="margin: 5px 0 0 0; color: #ff6b6b; font-weight: bold; font-size: 14px;">
                                üìè ${obj.distance}–º
                            </p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            const warningHTML = `
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; border-radius: 5px;">
                    <h3 style="color: #856404; margin: 0 0 15px 0;">‚ö†Ô∏è –ù–∞–º–µ—Ä–µ–Ω–∏ ${objects.length} –±–ª–∏–∑–∫–∏ –æ–±–µ–∫—Ç–∞ (100–º):</h3>
                    ${objectsHTML}
                    <div style="background: #dc3545; color: white; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 16px;">
                            ‚ö†Ô∏è –ê–∫–æ –≤–∏–∂–¥–∞—Ç–µ –æ–±–µ–∫—Ç–∞, –∫–æ–π—Ç–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞—Ç–µ, –∏–ª–∏ –∏–º–∞—Ç–µ —Å—ä–º–Ω–µ–Ω–∏—è —á–µ –≤–µ—á–µ –µ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞–Ω:
                        </p>
                        <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>–£–±–µ–¥–µ—Ç–µ —Å–µ</strong>, —á–µ –æ–±–µ–∫—Ç–∞ –Ω–µ –µ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞–Ω –≤–µ—á–µ.</li>
                            <li><strong>–ü—Ä–æ–≤–µ—Ä–µ—Ç–µ –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è—Ç–∞</strong> –Ω–∞ –æ–±–µ–∫—Ç–∞ –¥–∞–ª–∏ –µ –ø—Ä–∞–≤–∏–ª–Ω–∞ - –º–æ–∂–µ –¥–∞ –ø–æ–¥–∞–¥–µ—Ç–µ —Å–∏–≥–Ω–∞–ª –∏ –∑–∞ –≥—Ä–µ—à–Ω–æ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞–Ω –æ–±–µ–∫—Ç.</li>
                            <li><strong>‚õî –ü–æ–≤—Ç–æ—Ä–Ω–æ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –æ–±–µ–∫—Ç –≤–æ–¥–∏ –¥–æ –∑–∞–≥—É–±–∞ –æ—Ç –ï–î–ò–ù –î–ï–ù –∏–∑–ø–æ–ª–∑–≤–∞–Ω–µ –Ω–∞ —É—Å–ª—É–≥–∏—Ç–µ –Ω–∞ —á–∞—Ç–∞!</strong></li>
                            <li><strong>–ó–∞ —Ü–µ–ª—Ç–∞ –º–æ–∂–µ—Ç–µ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—Ç–µ –æ—Ç–¥–µ–ª–Ω–æ —Ç—ä—Ä—Å–µ–Ω–µ</strong> –≤ —Ä–∞–π–æ–Ω–∞, –≤ –∫–æ–π—Ç–æ —Å–µ –Ω–∞–º–∏—Ä–∞—Ç–µ, –∑–∞ –¥–∞ —Å–µ —É–±–µ–¥–∏—Ç–µ, —á–µ –æ–±–µ–∫—Ç–∞, –∫–æ–π—Ç–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞—Ç–µ, –≥–æ –Ω—è–º–∞ –≤—Å–µ –æ—â–µ –≤ –Ω–∞—à–∞—Ç–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏.</li>
                        </ul>
                    </div>
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 16px; color: #333;">
                            üîç –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –æ–±–µ–∫—Ç—ä—Ç —Å—ä—â–µ—Å—Ç–≤—É–≤–∞:
                        </p>
                        <a href="search.html" style="display: block; background: #007bff; color: white; padding: 12px; border-radius: 8px; text-decoration: none; text-align: center; margin: 8px 0; font-weight: bold;">
                            üìç –¢—ä—Ä—Å–µ–Ω–µ –ø–æ —Ä–∞–∑—Å—Ç–æ—è–Ω–∏–µ
                        </a>
                        <a href="search.html" style="display: block; background: #007bff; color: white; padding: 12px; border-radius: 8px; text-decoration: none; text-align: center; margin: 8px 0; font-weight: bold;">
                            üîé –¢—ä—Ä—Å–µ–Ω–µ –ø–æ –Ω—É–∂–¥–∞
                        </a>
                    </div>
                </div>
            `;
            
            const form = document.getElementById('signalForm');
            const existingWarning = document.getElementById('nearbyWarning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            const warningDiv = document.createElement('div');
            warningDiv.id = 'nearbyWarning';
            warningDiv.innerHTML = warningHTML;
            form.insertBefore(warningDiv, form.firstChild);
        }
        
        // Get location
        document.getElementById('getLocationBtn').addEventListener('click', () => {
            if (!navigator.geolocation) {
                showError('–ë—Ä–∞—É–∑—ä—Ä—ä—Ç –Ω–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è!');
                return;
            }
            
            document.getElementById('getLocationBtn').innerHTML = '‚è≥ –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ –ª–æ–∫–∞—Ü–∏—è...';
            document.getElementById('getLocationBtn').disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    latitude = position.coords.latitude;
                    longitude = position.coords.longitude;
                    
                    document.getElementById('locationInfo').style.display = 'block';
                    document.getElementById('locationCoords').textContent = 
                        `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                    
                    document.getElementById('getLocationBtn').innerHTML = '‚úÖ –õ–æ–∫–∞—Ü–∏—è—Ç–∞ –µ –∑–∞—Å–Ω–µ—Ç–∞';
                    checkFormComplete();
                },
                (error) => {
                    showError('–ù–µ –º–æ–∂–∞—Ö –¥–∞ –ø–æ–ª—É—á–∞ –ª–æ–∫–∞—Ü–∏—è—Ç–∞. –ú–æ–ª—è, —Ä–∞–∑—Ä–µ—à–∏ –¥–æ—Å—Ç—ä–ø –¥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ—Ç–æ.');
                    document.getElementById('getLocationBtn').innerHTML = 'üìç –û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ';
                    document.getElementById('getLocationBtn').disabled = false;
                }
            );
        });
        
        // Check if form is complete
        function checkFormComplete() {
            const signalType = document.getElementById('signalType').value;
            const title = document.getElementById('title').value;
            const hasPhoto = selectedFile !== null;
            const hasLocation = latitude !== null && longitude !== null;
            
            document.getElementById('submitBtn').disabled = !(signalType && title && hasPhoto && hasLocation);
        }
        
        // Monitor form changes
        document.getElementById('signalType').addEventListener('change', checkFormComplete);
        document.getElementById('title').addEventListener('input', checkFormComplete);
        
        // Submit form
        document.getElementById('signalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚è≥ –ü–æ–¥–∞–≤–∞–Ω–µ...';
            
            const formData = new FormData();
            formData.append('signal_type', document.getElementById('signalType').value);
            formData.append('title', document.getElementById('title').value);
            formData.append('working_hours', document.getElementById('workingHours').value);
            formData.append('latitude', latitude);
            formData.append('longitude', longitude);
            formData.append('photo', selectedFile);
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/api/signals/submit`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess('‚úÖ –°–∏–≥–Ω–∞–ª—ä—Ç –µ –ø–æ–¥–∞–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ! –©–µ –±—ä–¥–µ –ø—Ä–µ–≥–ª–µ–¥–∞–Ω –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.');
                    setTimeout(() => {
                        window.location.href = 'chat.html';
                    }, 2000);
                } else {
                    showError(data.error || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '–ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª';
                }
            } catch (error) {
                console.error('Error submitting signal:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ —Å–∏–≥–Ω–∞–ª. –û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '–ü–æ–¥–∞–π —Å–∏–≥–Ω–∞–ª';
            }
        });
        
        function showError(message) {
            document.getElementById('message').innerHTML = `<div class="error">${message}</div>`;
        }
        
        function showSuccess(message) {
            document.getElementById('message').innerHTML = `<div class="success">${message}</div>`;
        }
        
        // Check eligibility on load
        checkEligibility();
    </script>
</body>
</html>
