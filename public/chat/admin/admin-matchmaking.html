<!-- Version: 1.0056 -->
<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Matchmaking Checker</title>
    <link rel="stylesheet" href="/shared/css/common.css">
    <style>
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .info-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            color: #667eea;
        }

        .info-box p {
            margin: 5px 0;
            color: #666;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
        }

        .result-card h3 {
            margin: 0 0 10px 0;
            color: #667eea;
        }

        .result-card p {
            margin: 5px 0;
            color: #666;
            font-size: 0.95em;
        }

        .dislikes-list {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .dislikes-list h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }

        .dislike-tag {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            margin: 3px;
            font-size: 0.85em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .admin-note {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üîß Admin - Matchmaking Checker</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏ –º–∞—á–æ–≤–µ –∑–∞ –≤—Å–µ–∫–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª (–ë–ï–ó–ü–õ–ê–¢–ù–û)</p>
        </div>

        <!-- Check Form -->
        <div class="section">
            <h2>üë§ –ü—Ä–æ–≤–µ—Ä–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª</h2>
            <div class="form-group">
                <label>User ID:</label>
                <input type="number" id="userId" placeholder="–í—ä–≤–µ–¥–∏ User ID">
            </div>
            <button class="btn btn-primary" onclick="checkUser()">üîç –ü—Ä–æ–≤–µ—Ä–∏</button>
        </div>

        <!-- Results Section -->
        <div class="section hidden" id="resultsSection">
            <h2>üìä –†–µ–∑—É–ª—Ç–∞—Ç–∏</h2>
            
            <!-- User Info -->
            <div id="userInfo"></div>

            <!-- Criteria Info -->
            <div id="criteriaInfo"></div>

            <!-- Dislikes Info -->
            <div id="dislikesInfo"></div>

            <!-- Matches -->
            <div id="matchesInfo"></div>

            <div class="admin-note">
                ‚ÑπÔ∏è –¢–æ–≤–∞ –µ –∞–¥–º–∏–Ω—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ - –Ω–µ —Å–µ —Ç–∞–∫—Å—É–≤–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è
            </div>

            <button class="btn btn-primary" onclick="clearResults()">‚óÄ –ù–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞</button>
        </div>
    </div>

    <script src="/shared/js/config.js"></script>
    <script>
        const API_URL = window.APP_CONFIG.BASE_URL + '/api';
        let adminToken = null;

        // Check admin authentication
        function checkAuth() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                alert('–ú–æ–ª—è, –≤–ª–µ–∑—Ç–µ –∫–∞—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                window.location.href = 'admin.html';
                return false;
            }

            adminToken = token;
            return true;
        }

        // Check user
        async function checkUser() {
            const userId = document.getElementById('userId').value;

            if (!userId) {
                alert('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ User ID!');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/matchmaking/admin/check`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ userId: parseInt(userId) })
                });

                const data = await response.json();

                if (!response.ok) {
                    alert('‚ùå ' + (data.error || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞'));
                    return;
                }

                if (data.success) {
                    displayResults(data);
                } else {
                    alert('‚ùå ' + data.error);
                }
            } catch (error) {
                console.error('Check error:', error);
                alert('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞!');
            }
        }

        // Display results
        function displayResults(data) {
            // User info
            document.getElementById('userInfo').innerHTML = `
                <div class="info-box">
                    <h4>üë§ User Information</h4>
                    <p><strong>User ID:</strong> ${data.userId}</p>
                </div>
            `;

            // Criteria info
            if (data.criteria) {
                const criteriaHTML = `
                    <h3>üìã –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ</h3>
                    <div class="info-grid">
                        ${data.criteria.age_min || data.criteria.age_max ? `
                            <div class="info-box">
                                <h4>–í—ä–∑—Ä–∞—Å—Ç</h4>
                                <p>${data.criteria.age_min || 'N/A'} - ${data.criteria.age_max || 'N/A'} –≥–æ–¥.</p>
                            </div>
                        ` : ''}
                        ${data.criteria.height_min || data.criteria.height_max ? `
                            <div class="info-box">
                                <h4>–†—ä—Å—Ç</h4>
                                <p>${data.criteria.height_min || 'N/A'} - ${data.criteria.height_max || 'N/A'} cm</p>
                            </div>
                        ` : ''}
                        ${data.criteria.smoking ? `
                            <div class="info-box">
                                <h4>–¢—é—Ç—é–Ω–æ–ø—É—à–µ–Ω–µ</h4>
                                <p>${data.criteria.smoking}</p>
                            </div>
                        ` : ''}
                        ${data.criteria.drinking ? `
                            <div class="info-box">
                                <h4>–ê–ª–∫–æ—Ö–æ–ª</h4>
                                <p>${data.criteria.drinking}</p>
                            </div>
                        ` : ''}
                        ${data.criteria.education ? `
                            <div class="info-box">
                                <h4>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h4>
                                <p>${data.criteria.education}</p>
                            </div>
                        ` : ''}
                        ${data.criteria.relationship_goals ? `
                            <div class="info-box">
                                <h4>–¶–µ–ª–∏</h4>
                                <p>${data.criteria.relationship_goals}</p>
                            </div>
                        ` : ''}
                        ${data.criteria.country ? `
                            <div class="info-box">
                                <h4>–õ–æ–∫–∞—Ü–∏—è</h4>
                                <p>${data.criteria.city || 'N/A'}, ${data.criteria.country}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                document.getElementById('criteriaInfo').innerHTML = criteriaHTML;
            } else {
                document.getElementById('criteriaInfo').innerHTML = `
                    <p style="color:#999;">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –Ω—è–º–∞ –∑–∞–¥–∞–¥–µ–Ω–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏.</p>
                `;
            }

            // Dislikes info
            if (data.dislikes && data.dislikes.length > 0) {
                const dislikesHTML = `
                    <div class="dislikes-list">
                        <h4>‚ùå –ù–µ—â–∞, –∫–æ–∏—Ç–æ –ù–ï —Ö–∞—Ä–µ—Å–≤–∞ (${data.dislikes.length})</h4>
                        ${data.dislikes.map(d => `
                            <span class="dislike-tag">${d.dislike_field}: ${d.dislike_value}</span>
                        `).join('')}
                    </div>
                `;
                document.getElementById('dislikesInfo').innerHTML = dislikesHTML;
            } else {
                document.getElementById('dislikesInfo').innerHTML = `
                    <p style="color:#999;">–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ dislikes.</p>
                `;
            }

            // Matches info
            if (data.matches && data.matches.length > 0) {
                const matchesHTML = `
                    <h3>üéØ –ù–∞–º–µ—Ä–µ–Ω–∏ –º–∞—á–æ–≤–µ (${data.matchCount})</h3>
                    <div class="results-grid">
                        ${data.matches.map(match => `
                            <div class="result-card">
                                <h3>${match.full_name}</h3>
                                <p>üë§ User ID: ${match.id}</p>
                                <p>üéÇ –í—ä–∑—Ä–∞—Å—Ç: ${match.age || 'N/A'}</p>
                                <p>üìè –†—ä—Å—Ç: ${match.height_cm || 'N/A'} cm</p>
                                <p>‚öñÔ∏è –¢–µ–≥–ª–æ: ${match.weight_kg || 'N/A'} kg</p>
                                <p>üìç ${match.city || 'N/A'}, ${match.country || 'N/A'}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
                document.getElementById('matchesInfo').innerHTML = matchesHTML;
            } else {
                document.getElementById('matchesInfo').innerHTML = `
                    <p style="color:#999;">–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –º–∞—á–æ–≤–µ –∑–∞ —Ç–æ–∑–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª.</p>
                `;
            }

            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');
            window.scrollTo(0, 300);
        }

        // Clear results
        function clearResults() {
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('userId').value = '';
            window.scrollTo(0, 0);
        }

        // Initialize
        if (checkAuth()) {
            // Ready
        }
    </script>
</body>
</html>
